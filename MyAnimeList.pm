package LANraragi::Plugin::MyAnimeList;

use strict;
use warnings;

#Plugins can freely use all Perl packages already installed on the system 
#Try however to restrain yourself to the ones already installed for LRR (see tools/cpanfile) to avoid extra installations by the end-user.
use Mojo::UserAgent;
use URI::Escape;
use Mojo::DOM;

use LANraragi::Model::Plugins;
use LANraragi::Model::Config;

my $MAL_URL = "https://myanimelist.net/manga.php?q=";

# In case of rapid consecutive runs
# Comment out sleep($SLEEP) and this line to avoid sleeping
my $SLEEP = 2;

#Meta-information about your plugin.
sub plugin_info {
    return (
        #Standard metadata
        name  => "MyAnimeList.net",
        type  => "metadata",
        namespace => "malmetadata",
        author => "dngo99",
        version  => "0.5",
        description => "Searches MyAnimeList.net for tags matching your archive.",
        icon => " data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA+gAAAPoCAYAAABNo9TkAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAC4jAAAuIwF4pT92AABMVElEQVR42u3deZjdZX3/4c+ZJTPZQwgJ2UmAQFgie1hDwLpUWxU3qtXaWuuCYpClgtZai2V3oa22/rRoW7XSKlYRRJQQFgkQIAECISxJCNkTss4+c875/cFSjIFsM/M8Z859X1evBgiZ9wwxc17nuxWmnfUf5QAAAACSqkk9AAAAABDoAAAAkAWBDgAAABkQ6AAAAJABgQ4AAAAZEOgAAACQAYEOAAAAGRDoAAAAkAGBDgAAABkQ6AAAAJABgQ4AAAAZEOgAAACQAYEOAAAAGRDoAAAAkAGBDgAAABkQ6AAAAJABgQ4AAAAZEOgAAACQAYEOAAAAGRDoAAAAkAGBDgAAABkQ6AAAAJABgQ4AAAAZEOgAAACQAYEOAAAAGRDoAAAAkAGBDgAAABkQ6AAAAJABgQ4AAAAZEOgAAACQAYEOAAAAGRDoAAAAkAGBDgAAABkQ6AAAAJABgQ4AAAAZEOgAAACQAYEOAAAAGRDoAAAAkAGBDgAAABkQ6AAAAJABgQ4AAAAZEOgAAACQAYEOAAAAGRDoAAAAkAGBDgAAABkQ6AAAAJABgQ4AAAAZEOgAAACQAYEOAAAAGRDoAAAAkAGBDgAAABkQ6AAAAJABgQ4AAAAZEOgAAACQAYEOAAAAGRDoAAAAkAGBDgAAABkQ6AAAAJABgQ4AAAAZEOgAAACQAYEOAAAAGRDoAAAAkAGBDgAAABkQ6AAAAJABgQ4AAAAZEOgAAACQAYEOAAAAGRDoAAAAkAGBDgAAABkQ6AAAAJABgQ4AAAAZEOgAAACQAYEOAAAAGRDoAAAAkAGBDgAAABkQ6AAAAJABgQ4AAAAZEOgAAACQAYEOAAAAGRDoAAAAkAGBDgAAABkQ6AAAAJABgQ4AAAAZEOgAAACQAYEOAAAAGRDoAAAAkAGBDgAAABkQ6AAAAJABgQ4AAAAZEOgAAACQAYEOAAAAGRDoAAAAkAGBDgAAABkQ6AAAAJABgQ4AAAAZEOgAAACQAYEOAAAAGRDoAAAAkAGBDgAAABkQ6AAAAJABgQ4AAAAZEOgAAACQAYEOAAAAGRDoAAAAkAGBDgAAABkQ6AAAAJABgQ4AAAAZEOgAAACQAYEOAAAAGRDoAAAAkAGBDgAAABkQ6AAAAJABgQ4AAAAZEOgAAACQAYEOAAAAGRDoAAAAkAGBDgAAABkQ6AAAAJABgQ4AAAAZEOgAAACQAYEOAAAAGRDoAAAAkAGBDgAAABkQ6AAAAJABgQ4AAAAZEOgAAACQAYEOAAAAGRDoAAAAkAGBDgAAABkQ6AAAAJABgQ4AAAAZEOgAAACQAYEOAAAAGRDoAAAAkAGBDgAAABkQ6AAAAJABgQ4AAAAZEOgAAACQAYEOAAAAGRDoAAAAkAGBDgAAABkQ6AAAAJABgQ4AAAAZEOgAAACQAYEOAAAAGRDoAAAAkAGBDgAAABkQ6AAAAJABgQ4AAAAZEOgAAACQAYEOAAAAGRDoAAAAkAGBDgAAABkQ6AAAAJABgQ4AAAAZEOgAAACQAYEOAAAAGRDoAAAAkAGBDgAAABkQ6AAAAJABgQ4AAAAZEOgAAACQAYEOAAAAGRDoAAAAkAGBDgAAABkQ6AAAAJABgQ4AAAAZEOgAAACQAYEOAAAAGRDoAAAAkAGBDgAAABkQ6AAAAJABgQ4AAAAZEOgAAACQAYEOAAAAGRDoAAAAkAGBDgAAABkQ6AAAAJABgQ4AAAAZEOgAAACQAYEOAAAAGRDoAAAAkAGBDgAAABkQ6AAAAJABgQ4AAAAZEOgAAACQAYEOAAAAGRDoAAAAkAGBDgAAABkQ6AAAAJABgQ4AAAAZEOgAAACQAYEOAAAAGRDoAAAAkAGBDgAAABkQ6AAAAJABgQ4AAAAZEOgAAACQAYEOAAAAGRDoAAAAkAGBDgAAABkQ6AAAAJABgQ4AAAAZEOgAAACQAYEOAAAAGRDoAAAAkAGBDgAAABkQ6AAAAJABgQ4AAAAZEOgAAACQAYEOAAAAGRDoAAAAkAGBDgAAABkQ6AAAAJABgQ4AAAAZEOgAAACQAYEOAAAAGRDoAAAAkAGBDgAAABkQ6AAAAJABgQ4AAAAZEOgAAACQAYEOAAAAGRDoAAAAkAGBDgAAABkQ6AAAAJABgQ4AAAAZEOgAAACQAYEOAAAAGRDoAAAAkAGBDgAAABkQ6AAAAJABgQ4AAAAZEOgAAACQAYEOAAAAGRDoAAAAkAGBDgAAABkQ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AIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMiAQAcAAIAMCHQAAADIgEAHAACADAh0AAAAyIBABwAAgAwIdAAAAMjA/wcMivgSwblMuwAAAABJRU5ErkJggg==",
        #This name will be displayed in plugin configuration next to an input box for global arguments, and in archive edition for one-shot arguments.
        parameters  => [
            {type => "bool", desc => "Save archive title"},
            {type => "bool", desc => "Exact title match"}
        ],
        oneshot_arg => "MyAnimeList page URL (Will attach matching tags to your archive)"
    );

}

#Mandatory function to be implemented by your plugin
sub get_tags {

    #LRR gives your plugin the recorded title for the file, the filesystem path to the file, and the custom arguments if available.
    shift;
    my ( $title, $tags, $thumbhash, $file, $oneshotarg, $savetitle, $search ) = @_;

    #Use the logger to output status - they'll be passed to a specialized logfile and written to STDOUT.
    my $logger = LANraragi::Utils::Logging::get_logger("MyAnimeList","plugins");

	sleep($SLEEP);

    #Work your magic here - You can create subroutines below to organize the code better
    $logger->info("Searching myanimelist.net...");
    $logger->info("Received title: " . $title);
    
	my $url = "";
    my $new_title = "";
    my $new_tags = "";

	# Remove leading and trailing whitespace
	my $regex = qr/^\ *(.+[^ ])\ */;
    if ($title =~ m/$regex/) {
        $title = $1;
    }
	$logger->debug("parsing 1: " . $title);
	
	# Remove clusters of two or more whitespace
	$title =~ s/\ +/\ /g;
	$logger->debug("parsing 2: " . $title);

	# Locate URL from user or by searching
	$url = $oneshotarg;
	if ($url eq "") {
		 ($url) = get_url($title, $search, $logger);
	}
    $logger->debug("URL: " . $url);
	
	# Check if URL is valid
    if ($url eq $MAL_URL or $url eq "") {
        $logger->info("Search failed!");
        return (tags => $new_tags);
    }
	
	# Process URL web page and convert to text
    my $ua = Mojo::UserAgent->new;
    my $res = $ua->get($url)->result; 
    my $dom = Mojo::DOM->new( $res->body );
	my $txt = $dom->to_string;

	# Reduce the search area
	$regex = qr/(English:.*Statistics)/;
	# if ($txt =~ /(English:)/) {
	if ($txt =~ /(English:.*Statistics)/s) {
		#$txt = $1;
		$logger->debug("Processed||" . $1 . "||");
	}

	# Title
    $regex = qr/English:<\/span> *(.+?) *<\/div>/;
	if ($txt =~ m/$regex/) {
		$new_title = $1;
	}
	
	# Type
	$regex = qr/type=.+">(.*?)</;
	if ($txt =~ m/$regex/) {
		$new_tags .= process_tag("type", $1, $logger);
		$logger->debug("type:" . $1);
	}
	
	# Volumes
	$regex = qr/Volumes:<\/span> ([0-9]*)/;
	if ($txt =~ m/$regex/) {
		$new_tags .= process_tag("volumes", $1, $logger);
		$logger->debug("volumes:" . $1);
	} 

	# Chapters
	$regex = qr/Chapters:<\/span> ([0-9]*)/;
	if ($txt =~ m/$regex/) {
		$new_tags .= process_tag("chapters", $1, $logger);
		$logger->debug("chapters:" . $1);
	}
	
	# Status
    $regex = qr/Status:<\/span> *(.+?) *<\/div>/;
	if ($txt =~ m/$regex/) {
		$new_tags .= process_tag("status", $1, $logger);
		$logger->debug("status:" . $1);
	}
	
	# Genres
	$regex = qr/\/genre\/.*?title="(.*?)"/;
	while ($txt =~ m/$regex/g) {
		$new_tags .= process_tag("genre", $1, $logger);
		$logger->debug("genre:" . $1);
	}

	# Authors
	$regex = qr/\/people\/.*?">(.*?)<\/a>\ *(\(.*?\))[,<]/;
	while ($txt =~ m/$regex/g) {
		$new_tags .= process_tag("author", $1 . " " . $2, $logger);
		$logger->debug("author:" . $1 . " " . $2);
	}

	# Serialization
    $regex = qr/Serialization.*title="(.*?)"/;
	if ($txt =~ m/$regex/s) {
		$new_tags .= process_tag("serialization", $1, $logger);
		$logger->debug("serialization:" . $1);
	}

	# Source
	my $source = $url;
	$source =~ s/https?\:\/\///g;
	$new_tags .= "source:" . $source;
	$logger->debug("source:" . $url);

    # Remove trailing colon and space.
    $new_tags =~ s/,\ $//m;

    # Returning tags.
    if ($savetitle && $new_tags ne "") {
        $logger->info("Sendings tags LRR: " . $new_tags);
        $logger->info("Sending title to LRR: " . $new_title);
        return (tags => $new_tags, title => $new_title);
    }
    else {
        $logger->info("Sending tags to LRR: " . $new_tags);
        return (tags => $new_tags);
    }
}

# Searches the url of the work given title
sub get_url {
    my ( $title, $search, $logger ) = @_;
	
	# Search URL
    my $url = $MAL_URL . $title;
    $logger->debug("get_url URL: " . $url);
	$logger->debug("get_url title(old): " . $title);
		
	# Get the search page and convert it to text
    my $ua = Mojo::UserAgent->new;
    my $res = $ua->get($url)->result;
    my $dom = Mojo::DOM->new( $res->body );
    my $string = $dom->to_string;
	
	# Checking for anything that would throw off regex
	$title =~ s/\\\Q/.Q/g;
	$title =~ s/\\\E/.E/g;
	$logger->debug("get_url title(new): " . $title);
		
	# Exact title match, return immediately
	my $regex = qr/href=\"(.+\/manga\/.+?)\".+>(\Q$title\E)</;
	if ($string =~ m/$regex/) {
		$logger->debug("get_url found[MATCH]: " . $1);
		return $1;
	}
	
	# First search result, return if not matching exact title
	$regex = qr/href=\"(.+\/manga\/.+?)\"/;
	if ($string =~ m/$regex/ && !$search) {
	
		$logger->debug("get_url found: " . $1);
		return $1;
    }
	$logger->debug("get_url search failed");
	
	# Search failed
	return $MAL_URL;
}

# Processes and returns formated tags
sub process_tag {
    my ( $tag_name, $tag_contents, $logger ) = @_;
	
	my $tag_content = $tag_contents;
	# Checking for anything that would throw off regex
	$tag_content =~ s/\\\Q/.Q/g;
	$tag_content =~ s/\\\E/.E/g;
	
	# Get rid of colons so Lanraragi can process tags properly
    if ($tag_content =~ m/ : /g or $tag_content =~ m/[^ ]:[^ ]/g) {
        $tag_content =~ s/:/-/g;
    }
    if ($tag_content =~ m/[^ ]: | :[^ ]/g) {
        $tag_content =~ s/://g;
    }

	# Author / Artist split
	if ($tag_name eq "author" && $tag_content =~ m/Art/) {
		$tag_name = "artist";
	}
	
	# Remove parentheses
	$tag_content =~ s/ \(.*\)//;
	
	# Remove leading and trailing whitespace
	if ($tag_content =~ m/ *(.+[^ \n]) */) {
		$tag_content = $1;
	}
	
	# Reverse Japanese last name, first name
	if ($tag_content =~ m/(.*?), ([^ \(\n]+)/) {
		$tag_content = $2 . " " . $1;
	}
	
    return ($tag_content ne "") ? ($tag_name . ":" . $tag_content . ", ") : "";
}


1;
